<!doctype html>
<html lang="en" data-bs-theme="dark">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Character Creation – Step by Step</title>

  <!-- Bootstrap 5.3 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

  <style>
    :root {
      --brand: #a78bfa;
      --brand2: #22c55e;
      --ink: rgba(255, 255, 255, .90);
      --muted: rgba(255, 255, 255, .70);
      --surface: rgba(255, 255, 255, .06);
      --surface2: rgba(255, 255, 255, .10);
      --border: rgba(255, 255, 255, .12);
    }

    body {
      color: var(--ink);
      background:
        radial-gradient(1100px 520px at 18% 10%, rgba(167, 139, 250, .22), transparent 60%),
        radial-gradient(900px 500px at 80% 25%, rgba(34, 197, 94, .12), transparent 60%),
        linear-gradient(0deg, rgba(255, 255, 255, .02), rgba(255, 255, 255, .02));
      min-height: 100vh;
    }

    .muted {
      color: var(--muted);
    }

    .glass {
      background: var(--surface);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 1.25rem;
    }

    .panel {
      padding: 1.25rem;
    }

    .btn-brand {
      --bs-btn-bg: var(--brand);
      --bs-btn-border-color: var(--brand);
      --bs-btn-hover-bg: #8b5cf6;
      --bs-btn-hover-border-color: #8b5cf6;
      --bs-btn-focus-shadow-rgb: 167, 139, 250;
      --bs-btn-color: #0b0b0f;
      font-weight: 800;
    }

    .sheet-block {
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .04);
      padding: 1rem;
      height: 100%;
      position: relative;
      overflow: hidden;
      isolation: isolate;
      min-width: 0;
    }

    .block-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .75rem;
      margin-bottom: .85rem;
    }

    .block-title h3 {
      font-size: 1rem;
      margin: 0;
      letter-spacing: .10em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .88);
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: .45rem;
      padding: .35rem .6rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .05);
      color: var(--muted);
      font-size: .85rem;
      white-space: nowrap;
    }

    .field {
      display: grid;
      gap: .35rem;
      margin-bottom: .75rem;
      min-width: 0;
    }

    .field label {
      font-size: .78rem;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(255, 255, 255, .70);
    }

    .field input,
    .field textarea,
    .field select {
      width: 100%;
      min-width: 0;
      border-radius: .85rem;
      border: 1px solid rgba(255, 255, 255, .14);
      background: rgba(255, 255, 255, .05);
      color: var(--ink);
      padding: .65rem .75rem;
      outline: none;
      box-sizing: border-box;
    }

    .field textarea {
      min-height: 110px;
      resize: vertical;
    }

    .sheet-block input:focus,
    .sheet-block textarea:focus,
    .sheet-block select:focus {
      outline: none;
      border-color: rgba(167, 139, 250, .55);
      box-shadow: 0 0 0 .18rem rgba(167, 139, 250, .22);
    }

    .divider {
      border-top: 1px solid rgba(255, 255, 255, .10);
      margin: .9rem 0;
    }

    /* Wizard */
    .wizard {
      display: grid;
      grid-template-columns: 320px minmax(0, 1fr);
      gap: 1rem;
      align-items: start;
    }

    @media (max-width: 992px) {
      .wizard {
        grid-template-columns: 1fr;
      }
    }

    .steps {
      display: grid;
      gap: .6rem;
    }

    .step-btn {
      display: flex;
      gap: .75rem;
      align-items: center;
      width: 100%;
      text-align: left;
      padding: .85rem;
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .04);
      color: var(--ink);
      transition: background .15s ease, border-color .15s ease, transform .15s ease;
    }

    .step-btn:hover {
      background: rgba(255, 255, 255, .07);
      border-color: rgba(255, 255, 255, .18);
      transform: translateY(-1px);
      color: var(--ink);
    }

    .step-btn.active {
      border-color: rgba(167, 139, 250, .55);
      background: linear-gradient(90deg, rgba(167, 139, 250, .12), rgba(34, 197, 94, .07));
    }

    .step-num {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(255, 255, 255, .14);
      background: rgba(0, 0, 0, .12);
      font-weight: 800;
      flex: 0 0 auto;
    }

    .step-meta {
      min-width: 0;
    }

    .step-title {
      font-weight: 800;
      margin: 0;
      line-height: 1.1;
    }

    .step-desc {
      margin: .15rem 0 0 0;
      color: var(--muted);
      font-size: .9rem;
    }

    .progress-pill {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .75rem;
      padding: .8rem 1rem;
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .04);
    }

    .progress-pill .bar {
      flex: 1;
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .04);
      overflow: hidden;
    }

    .progress-pill .bar>div {
      height: 100%;
      width: 0%;
      background: rgba(167, 139, 250, .55);
    }

    /* Summary preview */
    .kv {
      display: grid;
      grid-template-columns: 160px minmax(0, 1fr);
      gap: .5rem .75rem;
      align-items: baseline;
    }

    .kv .k {
      color: rgba(255, 255, 255, .70);
      text-transform: uppercase;
      letter-spacing: .10em;
      font-size: .78rem;
    }

    .kv .v {
      color: var(--ink);
      overflow-wrap: anywhere;
    }

    /* Stat inputs */
    .stat-inputs {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: .75rem;
    }

    @media (max-width: 576px) {
      .stat-inputs {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: .25rem .55rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .12);
      background: rgba(255, 255, 255, .04);
      font-size: .85rem;
      color: var(--muted);
      white-space: nowrap;
    }

    /* Footer controls */
    .wizard-controls {
      display: flex;
      justify-content: space-between;
      gap: .75rem;
      flex-wrap: wrap;
      margin-top: 1rem;
    }

    /* Hide steps */
    .step-panel {
      display: none;
    }

    .step-panel.active {
      display: block;
    }
  </style>
</head>

<body>
  <header class="py-4">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
        <a class="btn btn-outline-light" href="dashboard.php">
          <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
        </a>

        <div class="d-flex gap-2">
          <button class="btn btn-outline-light" id="btnToggleTheme" type="button" title="Toggle theme">
            <i class="bi bi-sun"></i>
          </button>
          <button class="btn btn-brand" id="btnFinishTop" type="button">
            <i class="bi bi-check2-circle me-2"></i>Finish &amp; Create
          </button>
        </div>
      </div>
    </div>
  </header>

  <main class="container pb-5">
    <section class="glass panel">
      <div class="d-flex align-items-start justify-content-between flex-wrap gap-3">
        <div>
          <div class="text-uppercase muted" style="letter-spacing:.14em;font-size:.78rem;">Character Creation</div>
          <h1 class="mb-1" style="letter-spacing:-0.03em;line-height:1.05;">Step-by-step Wizard</h1>
          <div class="muted">Create a character in guided steps. You can jump between steps at any time.</div>
        </div>

        <div class="progress-pill" style="min-width: min(520px, 100%);">
          <div class="d-flex align-items-center gap-2">
            <span class="pill"><i class="bi bi-list-check"></i><span id="progressText">0/6</span></span>
            <span class="pill"><i class="bi bi-person-badge"></i><span id="liveName">Unnamed</span></span>
          </div>
          <div class="bar" aria-label="Progress">
            <div id="progressBar"></div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="wizard">
        <!-- LEFT: steps -->
        <aside class="steps" aria-label="Steps">
          <button class="step-btn active" type="button" data-step="1">
            <span class="step-num">1</span>
            <span class="step-meta">
              <p class="step-title">Basics</p>
              <p class="step-desc">Name, pronouns, heritage, class.</p>
            </span>
          </button>

          <button class="step-btn" type="button" data-step="2">
            <span class="step-num">2</span>
            <span class="step-meta">
              <p class="step-title">Traits</p>
              <p class="step-desc">Set the six trait modifiers.</p>
            </span>
          </button>

          <button class="step-btn" type="button" data-step="3">
            <span class="step-num">3</span>
            <span class="step-meta">
              <p class="step-title">Defense, Health & Hope</p>
              <p class="step-desc">Evasion, armor, HP, Hope</p>
            </span>
          </button>

          <button class="step-btn" type="button" data-step="4">
            <span class="step-num">4</span>
            <span class="step-meta">
              <p class="step-title">Experience</p>
              <p class="step-desc">Experience List</p>
            </span>
          </button>

          <button class="step-btn" type="button" data-step="5">
            <span class="step-num">5</span>
            <span class="step-meta">
              <p class="step-title">Gear</p>
              <p class="step-desc">Weapons, inventory, gold.</p>
            </span>
          </button>

          <button class="step-btn" type="button" data-step="6">
            <span class="step-num">6</span>
            <span class="step-meta">
              <p class="step-title">Review</p>
              <p class="step-desc">Validate and finalize.</p>
            </span>
          </button>
        </aside>

        <!-- RIGHT: step content -->
        <section class="sheet-block" aria-label="Step content">
          <!-- STEP 1 -->
          <div class="step-panel active" data-step-panel="1">
            <div class="block-title">
              <h3>Basics</h3>
              <span class="chip"><i class="bi bi-person"></i> Identity</span>
            </div>

            <div class="row g-3">
              <div class="col-12 col-lg-5">
                <div class="field">
                  <label for="cName">Name</label>
                  <input id="cName" type="text" placeholder="Character name" />
                </div>
              </div>

              <div class="col-12 col-lg-5">
                <div class="field">
                  <label for="cPronouns">Pronouns</label>
                  <input id="cPronouns" type="text" placeholder="they/them" />
                </div>
              </div>


              <div class="col-12 col-lg-2">
                <div class="field">
                  <label for="cLevel">Level</label>
                  <input id="cLevel" type="number" min="1" value="1" />
                </div>
              </div>

              <div class="col-12 col-lg-3">
                <div class="field">
                  <label for="cHeritage">Heritage</label>
                  <input id="cHeritage" type="text" placeholder="e.g. Human, Elf, ..." />
                </div>
              </div>

              <div class="col-12 col-lg-3">
                <div class="field">
                  <label for="cClass">Class</label>
                  <input id="cClass" type="text" placeholder="e.g. Guardian, Seraph, ..." />
                </div>
              </div>

              <div class="col-12 col-lg-3">
                <div class="field">
                  <label for="cSubClass">Subclass</label>
                  <input id="cSubClass" type="text" placeholder="e.g. Oathbound, ..." />
                </div>
              </div>

              <div class="col-12 col-lg-3">
                <div class="field">
                  <label for="cCommunity">Community</label>
                  <input id="cCommunity" type="text" placeholder="Wanderborn" />
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div class="step-panel" data-step-panel="2">
            <div class="block-title">
              <h3>Traits</h3>
              <span class="chip"><i class="bi bi-speedometer2"></i> Modifiers</span>
            </div>

            <div class="muted mb-3">
              Set your character's six trait modifiers using the following list (+2,+1,+1,0,0,-1).
            </div>

            <div class="stat-inputs">
              <div class="field">
                <label for="tAgility">Agility</label>
                <input id="tAgility" type="number" value="0" min="-5" max="5" />
              </div>
              <div class="field">
                <label for="tStrength">Strength</label>
                <input id="tStrength" type="number" value="0" min="-5" max="5" />
              </div>
              <div class="field">
                <label for="tFinesse">Finesse</label>
                <input id="tFinesse" type="number" value="0" min="-5" max="5" />
              </div>
              <div class="field">
                <label for="tInstinct">Instinct</label>
                <input id="tInstinct" type="number" value="0" min="-5" max="5" />
              </div>
              <div class="field">
                <label for="tPresence">Presence</label>
                <input id="tPresence" type="number" value="0" min="-5" max="5" />
              </div>
              <div class="field">
                <label for="tKnowledge">Knowledge</label>
                <input id="tKnowledge" type="number" value="0" min="-5" max="5" />
              </div>
            </div>

            <div class="divider"></div>

            <div class="sheet-block" style="padding:.85rem;">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <strong>Quick presets</strong>
                <span class="muted small">Optional helper buttons</span>
              </div>
              <div class="d-flex flex-wrap gap-2 mt-2">
                <button class="btn btn-outline-light btn-sm" type="button" data-preset="balanced">
                  Balanced (all 0)
                </button>
                <button class="btn btn-outline-light btn-sm" type="button" data-preset="agile">
                  Agile (+2 Agility)
                </button>
                <button class="btn btn-outline-light btn-sm" type="button" data-preset="strong">
                  Strong (+2 Strength)
                </button>
              </div>
            </div>
          </div>

          <!-- STEP 3 -->
          <div class="step-panel" data-step-panel="3">
            <div class="block-title">
              <h3>Defense, Health & Hope</h3>
              <span class="chip"><i class="bi bi-shield-heart"></i> Survival</span>
            </div>

            <div class="row g-3">
              <div class="col-12 col-lg-6">
                <div class="sheet-block">
                  <div class="block-title">
                    <h3>Defense</h3>
                    <span class="chip"><i class="bi bi-shield-check"></i> Values</span>
                  </div>

                  <div class="row g-3">
                    <div class="col-6">
                      <div class="field mb-0">
                        <label for="cEvasion">Evasion</label>
                        <input id="cEvasion" type="number" min="0" value="10" />
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="field mb-0">
                        <label for="cArmor">Armor</label>
                        <input id="cArmor" type="number" min="0" readonly />
                      </div>
                    </div>
                  </div>


                  <div class="divider"></div>
                  <div class="block-title">
                    <h3>Armor</h3>
                    <span class="chip"><i class="bi bi-shield"></i> Loadout</span>
                  </div>

                  <div class="field">
                    <label for="aName">Active Armor</label>
                    <input id="aName" type="text" placeholder="Leather armor" />
                  </div>

                  <div class="row g-3">
                    <div class="col-6">
                      <div class="field mb-0">
                        <label for="aThresh">Base Thresholds</label>
                        <input id="aThresh" type="text" placeholder="Minor/Major/Severe" />
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="field mb-0">
                        <label for="aScore">Base Score</label>
                        <input id="aScore" type="text" placeholder="+2" />
                      </div>
                    </div>
                  </div>

                  <div class="field mt-3">
                    <label for="aFeat">Armor Feature</label>
                    <input id="aFeat" type="text" placeholder="Light, Resistance..." />
                  </div>
                </div>
              </div>
              <div class="col-12 col-lg-6">
                <div class="sheet-block">
                  <div class="block-title">
                    <h3>Health</h3>
                    <span class="chip"><i class="bi bi-heart-pulse"></i> Tracks</span>
                  </div>

                  <div class="row g-3">
                    <div class="col-6">
                      <div class="field mb-0">
                        <label for="cHPMax">HP</label>
                        <input id="cHPMax" type="number" min="0" value="10" />
                      </div>
                    </div>
                  </div>

                  <div class="divider"></div>
                  <div class="block-title">
                    <h3>Hope</h3>
                    <span class="chip"><i class="bi bi-stars"></i> Resource</span>
                  </div>

                  <div class="field">
                    <label for="hopeMax">Hope</label>
                    <input id="hopeMax" type="number" min="0" value="6" readonly />
                  </div>

                  <div class="field mb-0">
                    <label for="cHopeFeature">Hope Feature</label>
                    <textarea id="cHopeFeature" readonly></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 4 -->
          <div class="step-panel" data-step-panel="4">
            <div class="block-title">
              <h3>Hope & Experience</h3>
              <span class="chip"><i class="bi bi-stars"></i> Roleplay</span>
            </div>

            <div class="row g-3">
              <div class="col-12">
                <div class="sheet-block">
                  <div class="block-title">
                    <h3>Experience</h3>
                    <span class="chip"><i class="bi bi-book"></i> Notes</span>
                  </div>

                  <div class="field mb-0">
                    <label for="cExperience">Experiences / Tags</label>
                    <textarea id="cExperience"
                      placeholder="e.g. 'Veteran of the Mistroads', 'Archivist', 'Oath-sworn' ..."></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- STEP 5 -->
          <div class="step-panel" data-step-panel="5">
            <div class="block-title">
              <h3>Gear</h3>
              <span class="chip"><i class="bi bi-backpack"></i> Equipment</span>
            </div>

            <div class="row g-3">
              <div class="col-12 col-lg-7">
                <div class="sheet-block">
                  <div class="block-title">
                    <h3>Weapons</h3>
                    <span class="chip"><i class="bi bi-crosshair"></i> Active</span>
                  </div>

                  <div class="row g-3">
                    <div class="">
                      <div class="sheet-block" style="padding:.85rem;">
                        <div>
                          <div class="d-flex align-items-center justify-content-between mb-2">
                            <strong>Primary</strong>
                            <span class="muted small">Proficiency (0-6)</span>
                          </div>
                          <div class="row g-2">
                            <div class="col-12">
                              <div class="field mb-0">
                                <label>Name</label>
                                <input id="w1Name" type="text" placeholder="Longbow" />
                              </div>
                            </div>
                            <div class="col-6">
                              <div class="field mb-0">
                                <label>Trait &amp; Range</label>
                                <input id="w1Trait" type="text" placeholder="Agility • Far" />
                              </div>
                            </div>
                            <div class="col-6">
                              <div class="field mb-0">
                                <label>Damage</label>
                                <input id="w1Dmg" type="text" placeholder="d8 • Piercing" />
                              </div>
                            </div>
                            <div class="col-12">
                              <div class="field mb-0">
                                <label>Feature</label>
                                <input id="w1Feat" type="text" placeholder="Special rule..." />
                              </div>
                            </div>
                            <div class="col-6">
                              <div class="field mb-0">
                                <label>Proficiency</label>
                                <input id="w1Prof" type="number" min="0" max="6" value="0" />
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="divider"></div>
                        <div>
                          <div class="d-flex align-items-center justify-content-between mb-2">
                            <strong>Secondary</strong>
                            <span class="muted small">Proficiency (0-6)</span>
                          </div>
                          <div class="row g-2">
                            <div class="col-12">
                              <div class="field mb-0">
                                <label>Name</label>
                                <input id="w2Name" type="text" placeholder="Dagger" />
                              </div>
                            </div>
                            <div class="col-6">
                              <div class="field mb-0">
                                <label>Trait &amp; Range</label>
                                <input id="w2Trait" type="text" placeholder="Finesse • Close" />
                              </div>
                            </div>
                            <div class="col-6">
                              <div class="field mb-0">
                                <label>Damage</label>
                                <input id="w2Dmg" type="text" placeholder="d6 • Slashing" />
                              </div>
                            </div>
                            <div class="col-12">
                              <div class="field mb-0">
                                <label>Feature</label>
                                <input id="w2Feat" type="text" placeholder="Special rule..." />
                              </div>
                            </div>
                            <div class="col-6">
                              <div class="field mb-0">
                                <label>Proficiency</label>
                                <input id="w2Prof" type="number" min="0" max="6" value="0" />
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 col-lg-5">
                <div class="sheet-block">
                  <div class="field">
                    <label for="cInventory">Inventory</label>
                    <textarea id="cInventory"></textarea>
                  </div>

                  <div class="divider"></div>

                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <strong>Gold</strong>
                    <span class="muted small">Handfuls / Bags / Chest</span>
                  </div>
                  <div class="row g-3">
                    <div class="col-4">
                      <div class="field mb-0">
                        <label for="gHandfuls">Handfuls</label>
                        <input id="gHandfuls" type="number" min="0" value="0" />
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="field mb-0">
                        <label for="gBags">Bags</label>
                        <input id="gBags" type="number" min="0" value="0" />
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="field mb-0">
                        <label for="gChest">Chest</label>
                        <input id="gChest" type="number" min="0" value="0" />
                      </div>
                    </div>
                  </div>

                </div>
              </div>


            </div>
          </div>

          <!-- STEP 6 -->
          <div class="step-panel" data-step-panel="6">
            <div class="block-title">
              <h3>Review</h3>
              <span class="chip"><i class="bi bi-clipboard-check"></i> Final</span>
            </div>

            <div class="muted mb-3">
              Review the details below. Click “Finish & Create” to finalize. (Hook this up to your backend later.)
            </div>

            <div class="sheet-block" style="padding:1rem;">
              <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                <strong>Live summary</strong>
                <span class="muted small" id="validationText">No validation errors.</span>
              </div>
              <div class="divider"></div>

              <div class="kv">
                <div class="k">Name</div>
                <div class="v" id="sumName">—</div>
                <div class="k">Pronouns</div>
                <div class="v" id="sumPronouns">—</div>
                <div class="k">Heritage</div>
                <div class="v" id="sumHeritage">—</div>
                <div class="k">Class</div>
                <div class="v" id="sumClass">—</div>
                <div class="k">Subclass</div>
                <div class="v" id="sumSubClass">—</div>
                <div class="k">Level</div>
                <div class="v" id="sumLevel">—</div>

                <div class="k">Traits</div>
                <div class="v" id="sumTraits">—</div>

                <div class="k">Defense</div>
                <div class="v" id="sumDefense">—</div>

                <div class="k">Health</div>
                <div class="v" id="sumHealth">—</div>

                <div class="k">Hope</div>
                <div class="v" id="sumHope">—</div>

                <div class="k">Experience</div>
                <div class="v" id="sumExp">—</div>
              </div>
            </div>

            <div class="divider"></div>

            <div class="d-flex gap-2 flex-wrap">
              <button class="btn btn-outline-light" type="button" id="btnExportJson">
                <i class="bi bi-braces me-2"></i>Export JSON (demo)
              </button>
              <button class="btn btn-outline-light" type="button" id="btnFillDemo">
                <i class="bi bi-magic me-2"></i>Fill Demo Data
              </button>
            </div>

            <pre class="mt-3 p-3" id="jsonOut"
              style="border-radius:1rem;border:1px solid rgba(255,255,255,.12);background:rgba(0,0,0,.18);color:rgba(255,255,255,.85);overflow:auto;max-height:280px;display:none;"></pre>
          </div>

          <!-- Controls -->
          <div class="wizard-controls">
            <button class="btn btn-outline-light" type="button" id="btnPrev">
              <i class="bi bi-arrow-left me-2"></i>Previous
            </button>

            <div class="d-flex gap-2 flex-wrap">
              <button class="btn btn-outline-light" type="button" id="btnSaveDraft">
                <i class="bi bi-save me-2"></i>Save Draft (Local)
              </button>
              <button class="btn btn-brand" type="button" id="btnNext">
                Next<i class="bi bi-arrow-right ms-2"></i>
              </button>
            </div>
          </div>

        </section>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

  <script>
    // ---------- Theme toggle ----------
    const btnToggleTheme = document.getElementById('btnToggleTheme');
    btnToggleTheme?.addEventListener('click', () => {
      const html = document.documentElement;
      const cur = html.getAttribute('data-bs-theme') || 'dark';
      html.setAttribute('data-bs-theme', cur === 'dark' ? 'light' : 'dark');
      btnToggleTheme.innerHTML = cur === 'dark' ? '<i class="bi bi-moon"></i>' : '<i class="bi bi-sun"></i>';
    });

    // ---------- Wizard navigation ----------
    const stepButtons = Array.from(document.querySelectorAll('.step-btn'));
    const stepPanels = Array.from(document.querySelectorAll('.step-panel'));
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    const btnFinishTop = document.getElementById('btnFinishTop');
    const btnSaveDraft = document.getElementById('btnSaveDraft');

    let currentStep = 1;
    const totalSteps = 6;

    function setStep(step) {
      currentStep = Math.max(1, Math.min(totalSteps, step));

      stepButtons.forEach(b => b.classList.toggle('active', parseInt(b.dataset.step, 10) === currentStep));
      stepPanels.forEach(p => p.classList.toggle('active', parseInt(p.dataset.stepPanel, 10) === currentStep));

      btnPrev.disabled = currentStep === 1;
      btnNext.innerHTML = currentStep === totalSteps
        ? 'Go to Review<i class="bi bi-clipboard-check ms-2"></i>'
        : 'Next<i class="bi bi-arrow-right ms-2"></i>';

      updateProgress();
      updateSummary();
      validateBasics();
    }

    stepButtons.forEach(b => b.addEventListener('click', () => setStep(parseInt(b.dataset.step, 10))));

    btnPrev.addEventListener('click', () => setStep(currentStep - 1));
    btnNext.addEventListener('click', () => setStep(currentStep + 1));
    btnFinishTop.addEventListener('click', () => {
      setStep(6);
      validateBasics(true);
    });

    // ---------- Progress ----------
    const progressText = document.getElementById('progressText');
    const progressBar = document.getElementById('progressBar');
    const liveName = document.getElementById('liveName');

    function countFilled() {
      // define required fields by step (basic minimal example)
      const required = [
        document.getElementById('cName'),
        document.getElementById('cPronouns'),
        document.getElementById('cHeritage'),
        document.getElementById('cClass'),
        document.getElementById('cLevel'),
      ];
      return required.filter(el => (el?.value ?? '').toString().trim().length > 0).length;
    }

    function updateProgress() {
      const filled = countFilled();
      progressText.textContent = `${filled}/5`;
      const pct = Math.round((filled / 5) * 100);
      progressBar.style.width = `${pct}%`;
    }

    // ---------- Presets ----------
    document.querySelectorAll('[data-preset]').forEach(btn => {
      btn.addEventListener('click', () => {
        const p = btn.dataset.preset;
        const set = (id, val) => document.getElementById(id).value = val;

        if (p === 'balanced') {
          ['tAgility', 'tStrength', 'tFinesse', 'tInstinct', 'tPresence', 'tKnowledge'].forEach(id => set(id, 0));
        }
        if (p === 'agile') {
          ['tAgility', 'tStrength', 'tFinesse', 'tInstinct', 'tPresence', 'tKnowledge'].forEach(id => set(id, 0));
          set('tAgility', 2);
        }
        if (p === 'strong') {
          ['tAgility', 'tStrength', 'tFinesse', 'tInstinct', 'tPresence', 'tKnowledge'].forEach(id => set(id, 0));
          set('tStrength', 2);
        }
        updateSummary();
      });
    });

    // ---------- Summary (Review) ----------
    const sumName = document.getElementById('sumName');
    const sumPronouns = document.getElementById('sumPronouns');
    const sumHeritage = document.getElementById('sumHeritage');
    const sumClass = document.getElementById('sumClass');
    const sumSubClass = document.getElementById('sumSubClass');
    const sumLevel = document.getElementById('sumLevel');
    const sumTraits = document.getElementById('sumTraits');
    const sumDefense = document.getElementById('sumDefense');
    const sumHealth = document.getElementById('sumHealth');
    const sumHope = document.getElementById('sumHope');
    const sumExp = document.getElementById('sumExp');

    const validationText = document.getElementById('validationText');

    function v(id) {
      const el = document.getElementById(id);
      return (el?.value ?? '').toString().trim();
    }

    function signed(n) {
      const num = parseInt(n, 10);
      if (Number.isNaN(num)) return '0';
      return (num >= 0 ? `+${num}` : `${num}`);
    }

    function updateSummary() {
      const name = v('cName') || 'Unnamed';
      liveName.textContent = name;

      sumName.textContent = v('cName') || '—';
      sumPronouns.textContent = v('cPronouns') || '—';
      sumHeritage.textContent = v('cHeritage') || '—';
      sumClass.textContent = v('cClass') || '—';
      sumSubClass.textContent = v('cSubClass') || '—';
      sumLevel.textContent = v('cLevel') || '—';

      sumTraits.textContent =
        `AGI ${signed(v('tAgility'))}, STR ${signed(v('tStrength'))}, FIN ${signed(v('tFinesse'))}, ` +
        `INS ${signed(v('tInstinct'))}, PRE ${signed(v('tPresence'))}, KNO ${signed(v('tKnowledge'))}`;

      sumDefense.textContent = `Evasion ${v('cEvasion') || '—'} • Armor ${v('cArmor') || '—'}`;
      sumHealth.textContent = `HP ${v('cHPMax') || '—'} • Stress ${v('cStressMax') || '—'} • ` +
        `Damage Slots (M/M/S): ${v('dMinor') || '—'}/${v('dMajor') || '—'}/${v('dSevere') || '—'}`;

      sumHope.textContent = `Hope max ${v('hopeMax') || '—'} • Feature: ${v('cHopeFeature') || '—'}`;
      sumExp.textContent = v('cExperience') || '—';

      updateProgress();
    }

    // ---------- Validation ----------
    function validateBasics(showAlert = false) {
      const missing = [];
      if (!v('cName')) missing.push('Name');
      if (!v('cPronouns')) missing.push('Pronouns');
      if (!v('cHeritage')) missing.push('Heritage');
      if (!v('cClass')) missing.push('Class');
      if (!v('cLevel')) missing.push('Level');

      if (missing.length) {
        validationText.textContent = `Missing: ${missing.join(', ')}.`;
        if (showAlert) alert(`Please fill required fields: ${missing.join(', ')}`);
        return false;
      }
      validationText.textContent = 'No validation errors.';
      return true;
    }

    // ---------- Draft save (localStorage) ----------
    function collectData() {
      return {
        basics: {
          name: v('cName'),
          pronouns: v('cPronouns'),
          heritage: v('cHeritage'),
          class: v('cClass'),
          subclass: v('cSubClass'),
          level: v('cLevel'),
          concept: v('cConcept'),
        },
        traits: {
          agility: v('tAgility'),
          strength: v('tStrength'),
          finesse: v('tFinesse'),
          instinct: v('tInstinct'),
          presence: v('tPresence'),
          knowledge: v('tKnowledge'),
        },
        defense: { evasion: v('cEvasion'), armor: v('cArmor') },
        health: {
          hpMax: v('cHPMax'),
          stressMax: v('cStressMax'),
          damageSlots: { minor: v('dMinor'), major: v('dMajor'), severe: v('dSevere') }
        },
        hope: { max: v('hopeMax'), feature: v('cHopeFeature') },
        experience: v('cExperience'),
        gear: {
          weapons: {
            primary: { name: v('w1Name'), trait: v('w1Trait'), damage: v('w1Dmg'), feature: v('w1Feat'), prof: v('w1Prof') },
            secondary: { name: v('w2Name'), trait: v('w2Trait'), damage: v('w2Dmg'), feature: v('w2Feat'), prof: v('w2Prof') },
          },
          armor: { name: v('aName'), thresholds: v('aThresh'), score: v('aScore'), feature: v('aFeat') },
          inventory: v('cInventory'),
          gold: { handfuls: v('gHandfuls'), bags: v('gBags'), chest: v('gChest') }
        }
      };
    }

    function fillData(data) {
      const set = (id, val) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.value = (val ?? '').toString();
      };

      set('cName', data?.basics?.name);
      set('cPronouns', data?.basics?.pronouns);
      set('cHeritage', data?.basics?.heritage);
      set('cClass', data?.basics?.class);
      set('cSubClass', data?.basics?.subclass);
      set('cLevel', data?.basics?.level);
      set('cConcept', data?.basics?.concept);

      set('tAgility', data?.traits?.agility);
      set('tStrength', data?.traits?.strength);
      set('tFinesse', data?.traits?.finesse);
      set('tInstinct', data?.traits?.instinct);
      set('tPresence', data?.traits?.presence);
      set('tKnowledge', data?.traits?.knowledge);

      set('cEvasion', data?.defense?.evasion);
      set('cArmor', data?.defense?.armor);

      set('cHPMax', data?.health?.hpMax);
      set('cStressMax', data?.health?.stressMax);
      set('dMinor', data?.health?.damageSlots?.minor);
      set('dMajor', data?.health?.damageSlots?.major);
      set('dSevere', data?.health?.damageSlots?.severe);

      set('hopeMax', data?.hope?.max);
      set('cHopeFeature', data?.hope?.feature);
      set('cExperience', data?.experience);

      set('w1Name', data?.gear?.weapons?.primary?.name);
      set('w1Trait', data?.gear?.weapons?.primary?.trait);
      set('w1Dmg', data?.gear?.weapons?.primary?.damage);
      set('w1Feat', data?.gear?.weapons?.primary?.feature);
      set('w1Prof', data?.gear?.weapons?.primary?.prof);

      set('w2Name', data?.gear?.weapons?.secondary?.name);
      set('w2Trait', data?.gear?.weapons?.secondary?.trait);
      set('w2Dmg', data?.gear?.weapons?.secondary?.damage);
      set('w2Feat', data?.gear?.weapons?.secondary?.feature);
      set('w2Prof', data?.gear?.weapons?.secondary?.prof);

      set('aName', data?.gear?.armor?.name);
      set('aThresh', data?.gear?.armor?.thresholds);
      set('aScore', data?.gear?.armor?.score);
      set('aFeat', data?.gear?.armor?.feature);

      set('cInventory', data?.gear?.inventory);
      set('gHandfuls', data?.gear?.gold?.handfuls);
      set('gBags', data?.gear?.gold?.bags);
      set('gChest', data?.gear?.gold?.chest);

      updateSummary();
    }

    btnSaveDraft.addEventListener('click', () => {
      const data = collectData();
      localStorage.setItem('dh_char_draft', JSON.stringify(data));
      alert('Draft saved locally.');
    });

    // Auto-load draft if present
    try {
      const raw = localStorage.getItem('dh_char_draft');
      if (raw) fillData(JSON.parse(raw));
    } catch (e) { /* ignore */ }

    // Update summary on input changes
    document.addEventListener('input', (e) => {
      if (e.target && (e.target.matches('input') || e.target.matches('textarea') || e.target.matches('select'))) {
        updateSummary();
      }
    });

    // ---------- Review actions ----------
    const btnExportJson = document.getElementById('btnExportJson');
    const btnFillDemo = document.getElementById('btnFillDemo');
    const jsonOut = document.getElementById('jsonOut');

    btnExportJson?.addEventListener('click', () => {
      const data = collectData();
      jsonOut.style.display = 'block';
      jsonOut.textContent = JSON.stringify(data, null, 2);
    });

    btnFillDemo?.addEventListener('click', () => {
      fillData({
        basics: { name: "Nyx Varr", pronouns: "she/her", heritage: "Human", class: "Guardian", subclass: "Oathbound", level: 2, concept: "A sworn shield of the mist roads" },
        traits: { agility: 1, strength: 2, finesse: 0, instinct: 1, presence: 1, knowledge: 0 },
        defense: { evasion: 10, armor: 2 },
        health: { hpMax: 10, stressMax: 10, damageSlots: { minor: 6, major: 4, severe: 3 } },
        hope: { max: 6, feature: "Once per scene, spend Hope to turn a failure into a success." },
        experience: "Veteran of the Nebelpfade; Archivkundig",
        gear: {
          weapons: {
            primary: { name: "Longspear", trait: "Strength • Reach", damage: "d8 • Piercing", feature: "Brace", prof: 2 },
            secondary: { name: "Dagger", trait: "Finesse • Close", damage: "d6 • Slashing", feature: "Hidden", prof: 1 }
          },
          armor: { name: "Leather Armor", thresholds: "Minor/Major/Severe", score: "+2", feature: "Light" },
          inventory: "- Rope (15m)\n- Torches (x3)\n- Healing draught (x1)\n- Notebook",
          gold: { handfuls: 1, bags: 0, chest: 0 }
        }
      });
      setStep(6);
    });

    // Finish action (demo)
    function finishCreate() {
      if (!validateBasics(true)) {
        setStep(1);
        return;
      }
      const data = collectData();
      // TODO: send to backend (fetch POST) when you have your API
      alert(`Character created (demo): ${data.basics.name || 'Unnamed'}`);
    }

    btnFinishTop.addEventListener('click', finishCreate);

    // Initialize
    setStep(1);
    updateSummary();
  </script>
</body>

</html>